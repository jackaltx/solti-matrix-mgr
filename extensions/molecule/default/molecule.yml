---
dependency:
  name: galaxy
driver:
  name: default
  options:
    managed: false
    ansible_connection_options:
      ansible_connection: local
platforms:
  - name: instance
    groups:
      - matrix
provisioner:
  name: ansible
  playbooks:
    converge: converge.yml
    verify: verify.yml
  inventory:
    group_vars:
      all:
        project_root: "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') }}"
        report_root: "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') }}/verify_output"

        # Pass environment variables to the test
        matrix_homeserver_url: "{{ lookup('env', 'MATRIX_HOMESERVER_URL') }}"
        matrix_room_id: "{{ lookup('env', 'MATRIX_ROOM_ID') }}"
        matrix_access_token: "{{ lookup('env', 'MATRIX_SOLTI_LOGGER_TOKEN') }}"
        matrix_admin_user: "{{ lookup('env', 'MATRIX_ADMIN_USER') }}"
        matrix_admin_token: "{{ lookup('env', 'MATRIX_ADMIN_TOKEN') }}"

        # Credentials for self-healing tests
        matrix_bot_user: "@solti-logger:jackaltx.com"
        matrix_bot_password: "{{ lookup('env', 'MATRIX_BOT_SOLTI_LOGGER_PASSWORD') }}"

scenario:
  test_sequence:
    - destroy
    - converge
    - verify
    - destroy

verifier:
  name: ansible
